from pyasn1_alt_modules import rfc5280

from pkilint import pkix
from tests import util


def test_serial_number_too_big():
    pem = """-----BEGIN CERTIFICATE-----
MIIGbTCCBFWgAwIBAgIVAOWp6NJ8S0rwHbwwa3hROxXLIRyeMA0GCSqGSIb3DQEB
CwUAMF8xCzAJBgNVBAYTAkZSMRMwEQYDVQQKEwpDZXJ0aW5vbWlzMRcwFQYDVQQL
Ew4wMDAyIDQzMzk5ODkwMzEiMCAGA1UEAxMZQ2VydGlub21pcyAtIEFBIGV0IEFn
ZW50czAeFw0xNzA2MDEwOTUwMjdaFw0yMDA1MzEwOTUwMjdaMIHbMQswCQYDVQQG
EwJGUjE4MDYGA1UEChMvQUdFTkNFIFBPVVIgTCdJTkZPUk1BVElRVUUgRklOQU5D
SUVSRSBERSBMJ0VUQVQxFzAVBgNVBGETDjAwMDIgMTMwMDE5NzcxMRcwFQYDVQQL
Ew4wMDAyIDEzMDAxOTc3MTEWMBQGA1UECBMNSWxlIGRlIEZyYW5jZTEOMAwGA1UE
BxMFUGFyaXMxJjAkBgNVBAMTHWNvbW11bmF1dGUuY2hvcnVzLXByby5nb3V2LmZy
MRAwDgYDVQQFEwcxLTUwNDgxMIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKC
AQEAzXu2kiFJXVZpFAX6Sh2WwlI7xqGmcSvpdBvnrjZkKPF+q959+NP5cJHm7u8k
LDY/o1RCZvYXErxC4AXCfpFTVDOgfeigaww4ATqbMjRVYzllVzWuj5LxRlfSttow
iABeQu6lN8osb6T2jUHzcBydu+yE9C6JhQuqqA7XSfX43a+7fbr6Dl44cvhnqCWj
bIlsUOEjHFSLkgcIrl8C1BVZZbIghSbPhkpbyx8kQ0XpaOLGobpwMOCej56DynMM
9NN7+bi0Je7XcUfiXu8DRrSZs6p9IuvwhnlZE4xXQzO84Mdu96QIusKXFDe/YdVS
X8Iiu281Qk2+6UEo50pA6p18iwIDAQABo4IBoTCCAZ0wDgYDVR0PAQH/BAQDAgWg
MFcGCCsGAQUFBwEBBEswSTBHBggrBgEFBQcwAYY7aHR0cDovL2lnYy1nMy5jZXJ0
aW5vbWlzLmNvbS9JTlNUQU5DRV9TSEEyL29jc3AvT0NTUF9BR0VOVFMwHwYDVR0j
BBgwFoAUSC2yyxZ4+YtWmGciR2zWUAGlq8gwCQYDVR0TBAIwADAXBgNVHSAEEDAO
MAwGCiqBegFWAgMHFAEwgY4GA1UdHwSBhjCBgzBMoEqgSIZGaHR0cDovL2NybC5p
Z2MtZzMuY2VydGlub21pcy5jb20vSU5TVEFOQ0VfU0hBMi9jcmwvQUNfQUdFTlRT
LWNybC0xLmNybDAzoDGgL4YtaHR0cDovL3d3dy5jZXJ0aW5vbWlzLmNvbS9jcmwv
YWNnMy1BR0VOVFMuY3JsMCgGA1UdEQQhMB+CHWNvbW11bmF1dGUuY2hvcnVzLXBy
by5nb3V2LmZyMB0GA1UdDgQWBBQJwjEWYMAPJQP2ox1/FslicSLOXDATBgNVHSUE
DDAKBggrBgEFBQcDATANBgkqhkiG9w0BAQsFAAOCAgEASqFoBtfMvKYbkoJPzb/k
lVYGQo3BfLD9e65MSBrz/ttgchQl8SFKDAGvbBaBnIl2/d/ajMCsGxqAA4yo4RZ2
GeKJOnVfqOdh8lF/4OLSWI0vMRsvhmpgB+h1x+HgBgw7NhvqOfym5W5mpNboxEI3
280DZrw9ca73uZC19XCsPfoj8K+eum7Cc0GniH06+0spL0UQ0Kzb70USnq2axVA0
/s8dnwl9KBDwwFtHi4fpexUIg8U6uKb3mcH4wsC6NSErTwN/KWEJJLoXT165CPJv
wRXPlnPsiFgv+sEEZlRXGkL3OJTLSN/wyRCGXKX9Ih0Y11g2739vPafK78sItMZl
JSYhO+ghT4zIENiWThmAJFXfsiQJaQmICWDh/J0Qs0dsGviUTqQMlUTYNyj9JVTJ
8V9xUh8bmAzU1ypoyNb6aNz5bpsEqsM3z92vfkiLD0gaAQ6mP1EXpt0206QDqON7
ZwUVzg7BrPh41JwOOXt/9of2zGdHDAuO0Eur6+8GFF6O0e4xDsr/IdCgvdsSjDeq
vWBci0ABF5plY8VjXy6QmYA55IxA26Zhj4qVXnhJfuM5Q8wp1XTNeN7zEy0nxo1I
m2bihYudY2b898g3E4k+wsovPieU1MqcuhfFZJ2Vak+gra0ndWfVlRTbBjSeJqtn
FNqVFqH0g3T6SeJbPvAU2mE=
-----END CERTIFICATE-----
"""

    validator = pkix.CertificateSerialNumberValidator()

    result = util.ExpectedResult(
        [validator.VALIDATION_FINDING_CERTIFICATE_SERIAL_NUMBER_OOR],
        pdu_class=rfc5280.CertificateSerialNumber,
    )

    util.certificate_test_harness(pem, validator, [result])


def test_serial_number_non_positive():
    pem = """-----BEGIN CERTIFICATE-----
MIIEvTCCA6WgAwIBAgIBADANBgkqhkiG9w0BAQUFADB/MQswCQYDVQQGEwJFVTEn
MCUGA1UEChMeQUMgQ2FtZXJmaXJtYSBTQSBDSUYgQTgyNzQzMjg3MSMwIQYDVQQL
ExpodHRwOi8vd3d3LmNoYW1iZXJzaWduLm9yZzEiMCAGA1UEAxMZQ2hhbWJlcnMg
b2YgQ29tbWVyY2UgUm9vdDAeFw0wMzA5MzAxNjEzNDNaFw0zNzA5MzAxNjEzNDRa
MH8xCzAJBgNVBAYTAkVVMScwJQYDVQQKEx5BQyBDYW1lcmZpcm1hIFNBIENJRiBB
ODI3NDMyODcxIzAhBgNVBAsTGmh0dHA6Ly93d3cuY2hhbWJlcnNpZ24ub3JnMSIw
IAYDVQQDExlDaGFtYmVycyBvZiBDb21tZXJjZSBSb290MIIBIDANBgkqhkiG9w0B
AQEFAAOCAQ0AMIIBCAKCAQEAtzZV5aVdGDDg2olUkfzIx1L4L1DZ77F1c2VHfRtb
unXF/KGIJPov7coISjlUxFF6tdpg6jg8gbLL8bvZkSM/SAFwdakFKq0fcfPJVD0d
BmpAPrMMhe5cG3nCYsS4No41XQEMIwRHNaqbYE6gZj3LJgqcQKH0XZi/caulAGgq
7YN6D6IUtdQis4CwPAxaUWktWBiP7Zme8a7ileb2R6jWDA+wWFjbw2Y3npuRVDM3
0pQcakjJyfKl2qUMI/cjDpwyVV5xnIQFUZot/eZOKjRa3spAN2cMVCFVd9oKDMyX
roDclDZK9D7ONhMeU+SsTjoF7Nuucpw4i9A5O4kKPnf+dQIBA6OCAUQwggFAMBIG
A1UdEwEB/wQIMAYBAf8CAQwwPAYDVR0fBDUwMzAxoC+gLYYraHR0cDovL2NybC5j
aGFtYmVyc2lnbi5vcmcvY2hhbWJlcnNyb290LmNybDAdBgNVHQ4EFgQU45T1sU3p
26EpW1eLTXYGduHRooowDgYDVR0PAQH/BAQDAgEGMBEGCWCGSAGG+EIBAQQEAwIA
BzAnBgNVHREEIDAegRxjaGFtYmVyc3Jvb3RAY2hhbWJlcnNpZ24ub3JnMCcGA1Ud
EgQgMB6BHGNoYW1iZXJzcm9vdEBjaGFtYmVyc2lnbi5vcmcwWAYDVR0gBFEwTzBN
BgsrBgEEAYGHLgoDATA+MDwGCCsGAQUFBwIBFjBodHRwOi8vY3BzLmNoYW1iZXJz
aWduLm9yZy9jcHMvY2hhbWJlcnNyb290Lmh0bWwwDQYJKoZIhvcNAQEFBQADggEB
AAxBl8IahsAifJ/7kPMa0QOx7xP5IV8EnNrJpY0nbJaHkb5BkAFyk+cefV/2icZd
p0AJPaxJRUXcLo0waLIJuvvDL8y6C98/d3tGfToSJI6WjzwFCm/SlCgdbQzALogi
1djPHRPH8EjX1wWnz8dHnjs8NMiAT9QUu/wNUPf6s+xCX6ndbcj0dc97wXImsQEc
XCz9ek60AcUFV7nnPKoF2YjpB0ZBzu9Bga5Y34OirsrXdx/nADydb47kMgkdTXg0
eDQ8lJsm7U9xxhl6vSAiSFr+S30Dt+dYvsYyTnQeaN2oaFuzPu5ifdmA6Ap1erfu
tGWaIZDgqtCYvDi1czyL+Nw=
-----END CERTIFICATE-----
"""

    validator = pkix.CertificateSerialNumberValidator()

    result = util.ExpectedResult(
        [validator.VALIDATION_FINDING_CERTIFICATE_SERIAL_NUMBER_OOR],
        pdu_class=rfc5280.CertificateSerialNumber,
    )

    util.certificate_test_harness(pem, validator, [result])
